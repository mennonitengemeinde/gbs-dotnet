@page "/register"
@using gbs.Client.Pages.Auth.Components
@layout AuthLayout
@inject IAuthService AuthService
@inject IUiService UiService
@inject NavigationManager NavigationManager

<EditForm Model="_registerDto" OnValidSubmit="HandleRegistration">
    <DataAnnotationsValidator />
    <MudGrid Justify="Justify.Center" Class="tw-pt-12">
        <MudItem xs="12" sm="8" md="5" lg="4">
            <MudCard Class="tw-relative tw-p-4">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h4">Login</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <AuthTabNav />

                    <MudFocusTrap DefaultFocus="DefaultFocus.FirstChild" Class="tw-space-y-2">
                        <MudTextField Label="First Name"
                                      @bind-Value="_registerDto.FirstName"
                                      For="() => _registerDto.FirstName" />
                        <MudTextField Label="Last Name"
                                      @bind-Value="_registerDto.LastName"
                                      For="() => _registerDto.LastName" />
                        <MudTextField Label="Email"
                                      InputType="InputType.Email"
                                      @bind-Value="_registerDto.Email"
                                      For="() => _registerDto.Email" />
                        <MudTextField Label="Password"
                                      InputType="InputType.Password"
                                      @bind-Value="_registerDto.Password"
                                      For="() => _registerDto.Password" />
                        <MudTextField Label="Confirm Password"
                                      InputType="InputType.Password"
                                      @bind-Value="_registerDto.ConfirmPassword"
                                      For="() => _registerDto.ConfirmPassword" />
                    </MudFocusTrap>
                </MudCardContent>
                <MudCardActions Class="tw-flex tw-justify-end tw-space-x-2">
                    <MudButton Variant="Variant.Text" Href="/">Cancel</MudButton>
                    <MudButton ButtonType="ButtonType.Submit"
                               Variant="Variant.Filled"
                               Color="Color.Primary"
                               StartIcon="@(_isProcessing ? null : Icons.Material.Filled.HowToReg)"
                               Disabled="@(_isProcessing)">
                        @if (_isProcessing)
                        {
                            <MudProgressCircular Class="-tw-ml-1 tw-mr-3" Size="Size.Small" Indeterminate="true" />
                        }
                        <MudText>Register</MudText>
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>
</EditForm>

@* <h1 class="card-title text-3xl">Sign Up</h1> *@
@* *@
@* <AuthTabNav /> *@
@* *@
@* @if (_message.Length > 0) *@
@* { *@
@*     <div class="@_messageCssClass py-4"> *@
@*         <span>@_message</span> *@
@*     </div> *@
@* } *@
@* *@
@* <EditForm Model="_registerDto" OnValidSubmit="HandleRegistration"> *@
@*     <DataAnnotationsValidator /> *@
@*     <TextInput Id="firstName" *@
@*                @ref="_firstNameInput" *@
@*                Label="First Name" *@
@*                @bind-Value="_registerDto.FirstName" *@
@*                For="() => _registerDto.FirstName" /> *@
@*     <TextInput Id="lastName" *@
@*                Label="Last Name" *@
@*                @bind-Value="_registerDto.LastName" *@
@*                For="() => _registerDto.LastName" /> *@
@*     <TextInput Id="email" *@
@*                Label="Email" *@
@*                InputType="email" *@
@*                @bind-Value="_registerDto.Email" *@
@*                For="() => _registerDto.Email" /> *@
@*     <TextInput Id="password" *@
@*                Label="Password" *@
@*                InputType="password" *@
@*                @bind-Value="_registerDto.Password" *@
@*                For="() => _registerDto.Password" /> *@
@*     <TextInput Id="confirmPassword" *@
@*                Label="Confirm Password" *@
@*                InputType="password" *@
@*                @bind-Value="_registerDto.ConfirmPassword" *@
@*                For="() => _registerDto.ConfirmPassword" /> *@
@* *@
@*     <div class="flex justify-end pt-4"> *@
@*         <Button Type="submit" Color="BtnColor.Primary" IsLoading="_loading">Create Account</Button> *@
@*     </div> *@
@* </EditForm> *@

@code {
    RegisterDto _registerDto = new RegisterDto();
    bool _isProcessing;

    async Task HandleRegistration()
    {
        _isProcessing = true;
        var response = await AuthService.Register(_registerDto);
        if (response.Success)
        {
            _isProcessing = false;
            NavigationManager.NavigateTo("login");
        }
        else
        {
            await UiService.ShowErrorAlert(response.Message);
            _isProcessing = false;
        }
    }

}