@page "/school/{Id:int}/live"
@attribute [Authorize(Policy = Policies.RequireAdminsSoundAndTeachers)]
@using Gbs.Client.Wasm.Pages.School.Components
@using Gbs.Client.Wasm.Services.Api.StreamService
@using Gbs.Client.Wasm.Services.UiService

@inject IStreamService StreamService
@inject IUiService UiService
@inject NavigationManager NavigationManager

<PageTitle>Live - GBS</PageTitle>

@if (LiveStream != null)
{
    <LiveVideoPlayer LiveStream="@LiveStream"/>
}

@code {
    [Parameter]
    public int Id { get; set; }
    
    [Parameter]
    public StreamDto? LiveStream { get; set; }

    protected override async Task OnInitializedAsync()
    {
        UiService.LoadingStart();
        var liveStream = await StreamService.GetStreamById(Id, true);
        if (!liveStream.Success)
        {
            UiService.LoadingStop();
            NavigationManager.NavigateTo("school");
        }
        else
        {
            LiveStream = liveStream.Data;
            UiService.LoadingStop();
        }
    }
}